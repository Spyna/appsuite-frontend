<?xml version="1.0" encoding="UTF-8"?>
<project name   ="jsbuild-eclipse-binding"
         basedir=".">

    <!-- =================================================================================
		 bind the jsbuild (namely grunt) to eclipse.
      -->

    <!-- =================================================================================
         convention over configuration (sometimes) :-)
         
         a) JSBUILD_HOME has to point to something like ${workspace_loc}/../jsbuild
            Its the git project where all these Ant scripts are checked in.
            
         b) Ensure ${basedir} points to the project calling this eclipse-binding script !
            Means : it must be the root of YOUR project.
            Dont use system file path which are not cross platform ...
            use eclipse variables instead !
      -->
	<fail message="Miss variable JSBUILD_HOME. Please define in your eclipse builder ...">
        <condition>
            <not><isset property="JSBUILD_HOME"/></not>
        </condition>
	</fail>

	<!-- load ant-contrib and friends to be able to write "better ant scripts" :-)
      -->
    <path id="jsbuild-eclipse-binding.lib-classpath">
        <fileset dir     ="${JSBUILD_HOME}/lib"
                 includes="*.jar"
        />
    </path>
	
    <taskdef resource="net/sf/antcontrib/antlib.xml">
        <classpath refid="jsbuild-eclipse-binding.lib-classpath" />
    </taskdef>

	<!-- load modules and initialize them
      -->
	<import file="${JSBUILD_HOME}/mod_grunt.xml" />
	<import file="${JSBUILD_HOME}/mod_done.xml"  />
	<import file="${JSBUILD_HOME}/mod_utils.xml" />

	<!-- comment it out to enable debug slowliness :-)
	<mod_utils.init feature.slow-down="true" />
	-->
	<mod_utils.init />
	<mod_done.init  out-path="${JSBUILD_HOME}/cache" />
	<mod_grunt.init />

	<!-- =================================================================================
      -->
    <target name="init">
		<property name="global.PROJECT_PATH" value="${basedir}" />
		<mod_grunt.prepare-gruntenv-in-project prjpath="${global.PROJECT_PATH}" />
	</target>

	<!-- =================================================================================
      -->
    <target name   ="clean"
    		depends="init">
        <echo message="clean : '${global.PROJECT_PATH}' ..." />
        <mod_grunt.clean prjpath="${global.PROJECT_PATH}" />
        <mod_utils.slow-down />
    </target>

    <!-- =================================================================================
      -->
    <target name   ="build-full"
    		depends="init">
        <echo message="build full : '${global.PROJECT_PATH}' ..." />
        <mod_grunt.build-full prjpath="${global.PROJECT_PATH}" />
        <mod_utils.slow-down />
    </target>

    <!-- =================================================================================
      -->
    <target name   ="build-incremental"
    		depends="init">
    	<echo message="build incremental : '${global.PROJECT_PATH}' ..." />
        <mod_grunt.build-incremental prjpath="${global.PROJECT_PATH}" />
        <mod_utils.slow-down />
    </target>

</project>
